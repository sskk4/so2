#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <limits.h>
#include <time.h>

struct thread_data {
	int *nums;
	int start;
	int end;
};

void *sum(void *arg) {
	struct thread_data dt = *(struct thread_data *)arg;

	int *nums = dt.nums;
	int start = dt.start;
	int end = dt.end;

	int *sum = (int *)malloc(sizeof(int));
	*sum = 0;

	int i;
	for (i = start; i < end; i++) {
		*sum = *sum + *(nums + i);
	}

	return (void *)sum;
};

void *min(void *arg) {
	struct thread_data dt = *(struct thread_data *)arg;

	int *nums = dt.nums;
	int start = dt.start;
	int end = dt.end;

	int min = INT_MAX;

	int i;
	for (i = start; i < end; i++) {
		int num = *(nums + i);
		if (num < min) min = num;
	}

	int *ret = (int *)malloc(sizeof(int));
	*ret = min;

	return (void *)ret;
}

void *max(void *arg) {
	struct thread_data dt = *(struct thread_data *)arg;

	int *nums = dt.nums;
	int start = dt.start;
	int end = dt.end;

	int max = INT_MIN;

	int i;
	for (i = start; i < end; i++) {
		int num = *(nums + i);
		if (num > max) max = num;
	}

	int *ret = (int *)malloc(sizeof(int));
	*ret = max;

	return (void *)ret;
}

int main(int argc, char *argv[]) {
	int nums[] = {1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
			1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,
				1,2,3,4,5,6,7,8,9,};

	int size = sizeof(nums) / sizeof(int);
	int half = size / 2;

	struct thread_data dt1;
	struct thread_data dt2;

	dt1.nums = nums;
	dt1.start = 0;
	dt1.end = half;

	dt2.nums = nums;
	dt2.start = half;
	dt2.end = size;

	pthread_t t1;
	pthread_t t2;

	clock_t start;
	clock_t end;
	double total_time;

	start = clock();
	if (pthread_create(&t1, NULL, *sum, (void *)&dt1) == -1 ||
		pthread_create(&t2, NULL, *sum, (void *)&dt2) == -1) {
		perror("Error when create");
		exit(1);
	}

	int *sum1;
	int *sum2;

	if (pthread_join(t1, (void *)&sum1) ||
		pthread_join(t2, (void *)&sum2)) {
		perror("Error when join");
		exit(1);
	}

	end = clock();

	int total = (*sum1) + (*sum2);

	total_time = (double)(end - start) / CLOCKS_PER_SEC;

	printf("total = %d\n", total);
	printf("total_time = %lf\n", total_time);

	printf("\n\n");

	pthread_t t3;
	pthread_t t4;

	start = clock();
	if (pthread_create(&t3, NULL, *min, (void *)&dt1) == -1 ||
		pthread_create(&t4, NULL, *min, (void *)&dt2) == -1) {
		perror("Error when create");
		exit(1);
	}

	int *min1;
	int *min2;

	if (pthread_join(t3, (void *)&min1) ||
		pthread_join(t4, (void *)&min2)) {
		perror("Error when join");
		exit(1);
	}

	end = clock();

	total = *min1 > *min2 ? *min2 : *min1;

	total_time = (double)(end - start) / CLOCKS_PER_SEC;

	printf("min = %d\n", total);
	printf("total_time = %lf\n", total_time);

	printf("\n\n");

	pthread_t t5;
	pthread_t t6;

	start = clock();
	if (pthread_create(&t5, NULL, *max, (void *)&dt1) == -1 ||
		pthread_create(&t6, NULL, *max, (void *)&dt2) == -1) {
		perror("Error when create");
		exit(1);
	}

	int *max1;
	int *max2;

	if (pthread_join(t5, (void *)&max1) ||
		pthread_join(t6, (void *)&max2)) {
		perror("Error when join");
		exit(1);
	}

	end = clock();

	total = *max1 > *max2 ? *max1 : *max2;

	total_time = (double)(end - start) / CLOCKS_PER_SEC;

	printf("max = %d\n", total);
	printf("total_time = %lf\n", total_time);

	return 0;
}

